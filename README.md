# 아리슬레나 공리

## 서문

### 소개

 **아리슬레나(Arislena)**는 소규모(4명~10명 내외)의 유저가 자신만의 설정이 담긴 가상 국가를 세우고(설정은 밸런스에 영향을 미치지 않는다), 세력전, 외교, 상거래 등 컨텐츠를 통해 각자의 국가를 키워 나가는 공동 세계관 게임이다. **아리**는 아리슬레나의 시스템 봇의 명칭이다.

### 상황

 2019년 말, **DRTN**을 중심으로 아리슬레나 제0시즌 개발을 시작했고, 2020년 1월 초에 제0시즌을 시작했다. 이후 2020년 1월 중순에 원작자 **DRTN**이 개발/운영에서 하차했다. **Frieyer**가 유지/보수/개발을 맡고 **Elna(Siadel)**가 디코방 운영을 맡아 2020년 2월경에 제0시즌을 마쳤다. 개발자 **Frieyer**는 아리의 코드에 한계가 많아 코드를 전면적으로 개선하려 하였지만, 시간적 여유 부족으로 인해 **Elna**가 개발을 시작하게 되었다.

 그리하여 2020년 3월부터 개발을 시작하였으나, **Elna**는 코딩을 처음부터 배워야 했으므로 작업 진척이 더뎠다. 개발 중간 약 3회의 전면적 내부 수정도 이뤄지면서 진척을 이루지 않았고, 결국 입대일인 5월 25일 이전에 개발을 완료하지 못했다.

### 읽는 이가 알아둬야 할 것

1. 개발자는 관리자를 포함할 수 있다. 따라서 디스코드 방 관리자로서 해야 할 일도 동시에 담는다.

# 디코방 운영

## 권한

 아리슬레나 디스코드 방에는 **관리자**, **개발자**, **서기**, **자문단**, **왕**이라는 권한이 존재한다. 서기와 자문단은 항상 왕을 겸하며, 개발자는 항상 관리자를 겸한다. 따라서 권한은 크게 **관리자 / 왕**으로 나뉜다. 권한을 디스코드 내에서 한 눈에 파악할 수 있게 **역할**을 배정해줘야 한다. 역할명과 권한명은 같다.

### 관리자

 관리자는 아리슬레나 디스코드 방의 운영을 총괄한다. 채널/카테고리 신설/유지/삭제, 게임 진행, 봇 실행/종료/유지/개발 등이 기본적인 업무다.

### 개발자

 개발자는 관리자와 권한 설정은 같으나, 주 업무가 봇과 관련한 자다. 관리자 부재 시 개발자가 관리자 일을 할 수 있다.

### 서기

 서기는 게임이 진행 중일 때 특수한 컨텐츠를 만드는 사람이다. (나라 관계도 만들기 등) 필수적인 역할은 아니다.

### 자문단

 자문단은 관리자/개발자와 협력해 게임을 이끌어나가는 사람이다. 게임 시스템에 대해 깊은 지식을 요한다. 베타 테스터 역할도 한다.

### 왕

 아리슬레나에 나라를 신청하여, 나라를 운영할 수 있는 사람이다.

### 모두 (일반)

 나라를 신청하지 않은 나머지 사람이다.

## 관리자의 주요 업무

1. 게임 운영
   정해진 시간에 `!새날`로 아리슬레나에 시간이 흐르게 해야 한다. 유저들이 전쟁/식민/지역 이름 변경 등 민원을 해오면 가능한 한 빠르게 대응해야 한다. (원칙적으로는 다음 `!새날`까지 처리하면 되지만, 편한 게임 환경 제공을 위해서다) 이외 업데이트/버그 수정 공지, 기타 공지 등 많지는 않으나 매일 1시간 정도는 투자해야 할 일이 생긴다. 일은 언제 생길지 모르니 여유 시간이 많은 사람이 하는 것이 좋다.
2. 디코방 운영
   인원 관리, 역할 관리, 홍보, 분탕/잠수 잡기 등 디코방 관리에 신경써야 한다. 이 부분은 유저 대부분이 (보기에) 온건한 편이므로 나름 안정적이다.
3. 꾸준한 규칙 성문화/엄밀화
   규칙을 완성도 있게 정리하는 것도 관리자의 몫이나, 현재까지는 제대로 이행되지 않고 있다. 그러나 성문화/엄밀화를 진행한다면 비생산적인 유저/관리자 간의 게임 규칙 논쟁을 막을 수 있는 등 효과가 분명 존재한다.

# 개발

## 개념



## 전체적인 파일 구조

 파일은 크게 **코드 파일**과 **데이터 파일**로 나뉜다. 코드 파일은 말 그대로 python 코드 파일이고, 데이터 파일은 json으로 각종 데이터를 담는다.

### -코드 파일-

### Ari_data.py

 이 파일은 **기본 상수, 계산 공식, 데이터 파일 정의, 데이터 생성/삭제/수정, 데이터 검색, 데이터 카테고리화** 등 계산, 데이터와 관련한 모든 클래스와 함수가 들어 있는 파일이다. 사실상 아리의 전신이라고 할 수 있다. 이 파일에서 기본적인 작업을 완료한 후, **Ari_slena** 파일에서 그것을 절차에 따라 실행하거나 결과를 보기 좋게 embed(첨부물) 형식으로 디코방에 출력하는 게 의도한 개발 방향이다.

### Ari_slena.py

 아리의 본체가 되는 파일이다. 이 파일을 실행하면 봇이 켜진다. Ari_data와 후술할 Ari_msg를 모듈로서 import한다. **해당 파일에서만 쓰는 특수 함수, 오류 클래스, 명령어 클래스, 봇 실행부(@ari.event)**가 들어 있다.

 Ari_data는 `from Ari_data import *`로 import했기 때문에, `Ari_data.~~`처럼 클래스나 인스턴스를 참조하지 않는다.

### Ari_msg.py

 **Ari_slena에서 쓸 첨부물/일반 메세지**를 모아둔 파일이다. (Ari_slena의 명령어).(용도) 형식으로 이름을 정했으며, 그러한 형식이면 해당 str을 바로 가져올 수 있다.

### -데이터 파일-

### Token.json

 토큰 정보를 저장한 파일이다. Ari_slena에서 봇의 토큰을 가져올 때만 쓰이며, 웬만해서는 내용을 바꿀 일이 없을 것이다.

### system.json

 시스템 정보를 저장하는 파일이다. 저장하는 정보는

1. 식량 재고(food_stock)
2. 자재 재고(matl_stock)
3. 식량 가격(food_price)
4. 자재 가격(matl_price)
5. 새날 실행 횟수(refresh_times)
6. 다음 원주민 번호(native_number)

다. **다음 원주민 번호**는 후술할 seq와 기능이 동일하다.

### seq.json

 Sqlite3의 sequence table에서 영향을 받았다. Area계, Nation계 파일의 다음 row 번호를 저장하는 파일이다.

### Area계

 Area로 시작하며, 지역 정보만 저장하는 파일이다. 

### Nation계

 Nation으로 시작하며, 나라 정보만 저장하는 파일이다.

### Info형

 Info로 끝나며, 자주 참조하는 정보를 저장하는 파일이다.

AreaInfo : 지역명, 지역오너명, 현재 식량, 현재 자재, 현재 기술, 현재 문화, 공격병비율, 충성도, 지역속성

NationInfo : 나라명, 오너명, 현재 자금, 현재 빚, 남은 상환 기간, 가용 정책 점수, 금일 행동 횟수, 호전성 수치

### Policy형

 Policy로 끝나며, 각 정책에 투자한 점수를 저장하는 파일이다.

AreaPolicy, NationPolicy : 각각 6개의 투자 카테고리가 있다.

### Extra형

 Extra로 끝나며, 자주 참조하지 않는 정보/Info와 분리해야 하는 정보 등을 저장하는 파일이다.

AreaExtra : 초기 식량/자재/기술/문화 스탯

NationExtra : 초기 나라명/오너명, 유저 여부, 보호 잔여일

### `_standatd_relation`형

 `_standard_relation`으로 끝나며, 지역/나라를 기준으로 한 포함 관계를 저장하는 파일이다.

`area_standard_relation` : 지역 ID : 나라 ID 1:1 대응 파일이다. str : str 형식으로 저장한다. 모든 지역은 어떤 나라와 반드시 소유 관계를 맺어야 한다. 그게 아니라면, 삭제해야 한다.

`nation_standard_relation` : 나라 ID : 지역 ID 1:다 대응 파일이다. str : list 형식으로 저장한다. 나라는 지역을 여러 개 소유할 수 있으며, 지역을 하나도 소유하지 않을 수도 있다.

## 아리(봇)의 말투

 기본적으로 반말체다. 이는 예전에 시행한 투표로 공인된 바 있다. 지향해도 되고 안 지향해도 되지만, 디테일한 컨셉을 말하자면 **친한 여자 친구** 정도라고 말할 수 있다. 부담스럽다면 **비서 말투에 반말만 끼얹으면** 된다.

 유저별로 말투를 다르게 하는 **코스튬**이 논의된 바 있지만, 구현 부담 때문에 우선순위에서 밀렸다.

## 명령어

 모든 아리슬레나 구성원은 봇(명칭 : 아리)에 명령어로 명령을 내려 특정 행동을 수행할 수 있다. 명령어의 권한은 **관리자**, **왕**, **모두**로 나뉜다. 관리자는 왕, 모두의 상위 권한이며 왕은 모두의 상위 권한이다. 디스코드 역할과 짝짓자면 **관리자 - 관리자/개발자, 왕 - 왕/자문단/서기, 모두 - 일반(역할이 없는 유저)** 이 된다.

### 양식

1. 모든 명령어는 `!`로 시작하며, ` `(공백) 또는 `'' / ""`(따옴표)로 구분한다. 

   `!명령어 인자1 인자2 인자3` 과 같이 구분한다.

2. 따옴표 안에는 항상 공백이 있어야 한다. 즉,
   `!명령어 '공백이 들어간 말'`은 유효하지만,
   `!명령어 '공백없는말'`은 유효하지 않다.

3. 따옴표는 항상 `'`로 시작해 `'`로 끝나거나, `"`로 시작해 `"`로 끝나야 한다.

4. 명령어를 작성할 때, 괄호`()`는 반드시 포함해야 할 인자고, 대괄호`[]`는 포함해도 되고 안 해도 되는 인자다.

5. `, ...`은 인자 여러 개를 쓸 수 있다는 의미다.

## 나라 건국

 유저는 **#나라신청**에 양식에 맞춰 나라를 신청할 수 있다. 유저가 신청을 하면 관리자는 명령어를 이용해 유저의 나라를 데이터에 추가한다.

### 양식

 ```
!건국 (지역명) (나라명) (오너명) (초기 식량) (초기 자재) (초기 기술) (초기 문화)
 ```

### 권한

 관리자만 쓸 수 있다.

### 작동

 파일 Ari_data의 클래스 Make의 classmethod 함수 user_nation() 참조

### 조건

1. `(지역명) (나라명) (오너명)`은 다른 지역명/나라명/오너명과 겹치지 않아야 한다.

2. `(초기 식량) (초기 자재) (초기 기술) (초기 문화)`는 숫자여야 하며, 총합이 20이어야 한다.

### 주의 사항

1. 오너명은 디스코드 유저 닉네임`Blabla#IJKL의 Blabla 부분`과 관련 있다. 방에서 표기되는 닉네임과는 관련이 없다. 방에서 닉네임을 바꿔도 상관이 없지만, 유저 닉네임을 바꾸면 봇이 다른 유저로 취급한다.
2. 테스트를 이유로 나라를 건국할 때, 지역명/나라명/오너명 중 하나라도 기존 지역명/나라명/오너명과 겹치지 않아야 한다. 나중에 해당 나라를 삭제할 때 큰 문제가 따른다.

## 시스템 중지, 시스템 재개

 **시스템 중지**는 모든 명령어 사용 권한을 **관리자**로 높이는 명령어다. (= 관리자 외에는 명령어를 쓸 수 없다.) **시스템 재개**는 그렇게 변경된 권한을 원 상태로 돌린다.

### 양식 (시스템 중지)

```
!중지
```

### 양식 (시스템 재개)

```
!재개
```

### 권한

 관리자만 쓸 수 있다.

### 작동

 파일 Ari_slena의 class Stop과 Restart 참조

## 식민, 편입, 병합, 추방

 식민 : 제 0시즌의 **소유권이전**을 계승한 명령어다.

 편입 : 원주민 외교라는 개념이 생기면서 도입된 새 식민 방식이다. 지역이 식민지가 되어도 충성도를 그대로 유지한다.

 병합 : 제 0시즌의 **병합**을 계승한 명령어다.

 추방 : 수도가 아닌 휘하 지역을 원주민 지역으로 격하하는 명령어다.

### 양식

### 권한

 관리자만 쓸 수 있다.

### 작동

 유저가 원하는 지역의 식민/편입/병합/추방을 먼저 요청해야 할 수 있다.

##  새날

 제 0시즌의 **리프레시**를 계승한 명령어다.

### 양식

```
!새날
```

### 권한

 관리자만 쓸 수 있다.

### 작동

 미구현

### 주의 사항

1. 정해진 시간에만 써야 한다. 테스트 목적이 아니고서는 정해진 시간에 써야 정상적인 게임 운영이 가능하다.

## 열람

 시즌 0의 명령어 **열람**을 계승한 명령어다. 검색 분류와 검색어를 이용해 원하는 지역/나라의 대략적인 정보를 열람할 수 있다.

### 양식

```
!열람 [(검색 분류) (검색어)]
```



## 공격병 설정

 자신 나라의 특정 지역, 혹은 모든 지역의 공격병 수치(0 ~ 1000)를 지정하는 명령어다.

### 양식

```
!공격병 [(검색 분류) (검색어, ...)] 
```



### 권한



### 작동



# 아리슬레나 운용에 필요한 최소한의 명령어 목록(작성 요망)
## 출력을 의도대로 수행하는 명령어
## 출력을 의도대로 수행하지 않는 명령어
## 출력이 정해지지 않은 명령어
